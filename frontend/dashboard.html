<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



<!-- Add Flatpickr CSS and JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

   <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<!-- Optional: Flatpickr dark theme support -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <title>Bookkeeping</title>

 


  
      <link rel="stylesheet" href="style.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

</head>
<body>





  

<div class="navbar">
  
  <div class="dropdown">
    
    <button class="dropbtn">Settings
      <i class="fa fa-caret-down"></i>
    </button>
    <div class="dropdown-content">
     
      <a href="#" id="full"  onclick="openFullscreen();">Full Screen</a>
     <a href="#" id="close"    onclick="closeFullscreen();">Close Screen</a>
           <a href="#" id="zoomInButton">Zoom In</a>
    <a href="#" id="zoomOutButton">Zoom Out</a>
   <a  href="#" id="resetZoomButton">Reset</a>
    </div>
 
 </div>
<div class="dropdown">
    <button class="dropbtn">Table
      <i class="fa fa-caret-down"></i>
    </button>
    <div class="dropdown-content">
     
       <a  onclick="logout()">üîê Logout</a>
           <a onclick="showUserManagerModal()">üë• Manage Users</a>
    <a onclick="deleteAllEntries()">üß® Delete All Entries</a>
                <a  onclick="backupData()">üì¶ Backup</a>
 <input type="file" id="restoreFile" style="display:none" onchange="restoreBackup(event)" />
 <a  onclick="document.getElementById('restoreFile').click()">‚ôªÔ∏è Restore</a>
    </div>

 </div>


<div class="dropdown">
    <button class="dropbtn">Export
      <i class="fa fa-caret-down"></i>
    </button>
    <div class="dropdown-content">
     
     

                <button id="bt3"> <label for="importCSV" class="custom-file-label">üì• Import CSV</label></button>
                <input type="file" id="importCSV" accept=".csv" style="display: none;" />
 <input type="file" id="restoreFile" style="display:none" onchange="restoreBackup(event)" />

  <a  onclick="exportCombinedCSV()">üì§ Export CSV</a>

<a onclick="window.print()">üñ®Ô∏è Print</a>
<a onclick="window.print()">üßæ Export PDF</a>

     
 </div>
</div>
</div>  

<div class="tabs-wrapper">
 <div class="tabs">
 <button class="tab-button active" onclick="openTab('dashboardTab', this)">üìä  Data</button>
      <button class="tab-button" onclick="openTab('chartsTab', this)">üìà  Chart</button>
   

     <button id="themeToggle" onclick="toggleTheme()" > 
   <i class="fa-solid fa-moon"></i>Theme
</button>
</div>
</div>


 <!-- Charts Tab -->
  <div id="chartsTab" class="tab-content">
   
    <div class="chart-controls">
      <label for="chartType">Chart Type:</label>
      <select id="chartType">
        <option value="bar">Bar</option>
        <option value="line">Line</option>
      </select>
<div class="dropdown2">
  <button class="dropdown-toggle">üë§ Person</button>
  <div class="dropdown-content2" id="personDropdown">
    <!-- Dynamically inserted checkboxes go here -->
  </div>
</div>



      <button onclick="downloadChart('monthlyChart')">‚¨áÔ∏è Monthly</button>
      <button onclick="downloadChart('personChart')">‚¨áÔ∏è Person</button>
      <button onclick="downloadChart('comparisonChart')">‚¨áÔ∏è Comparison</button>
      <button onclick="downloadChart('pieChart')">‚¨áÔ∏è Pie</button>
    </div>

    <canvas id="monthlyChart" height="300" width="1200" ></canvas>
   
  <canvas id="summaryChart" height="300" width="1200"></canvas>
  <canvas id="averageChart" height="300" width="1200"></canvas>
    <canvas id="personChart" height="300" width="1200"></canvas>
    <canvas id="comparisonChart" height="300" width="1200"></canvas>
    <canvas id="pieChart" height="300" width="1200"></canvas>
  </div></div>  

<div class="filter-grid">
 <form id="entryForm" class="entry-form responsive-form">
  <div class="form-grid">
    <input type="text" id="newDate" placeholder="Select Date" class="flatpickr-input">
    <input type="text" id="newDescription" placeholder="Description" required />
    <input type="number" step="0.01" id="newAmount" style="text-align: left;" placeholder="Amount" required />

    <select id="newCurrency" required>
      <option value="CHF">CHF</option>
      <option value="EUR">EUR</option>
      <option value="USD">USD</option>
    </select>

    <select id="newType">
      <option>Income</option>
      <option>Expense</option>
      <option>Transfer</option>
    </select>

    <input list="personList" id="newPerson" placeholder="Person" required />
    <datalist id="personList"></datalist>

    <input list="bankList" id="newBank" placeholder="Bank" required />
    <datalist id="bankList"></datalist>

    <input type="text" id="newCategory" placeholder="Category" list="newCategoryList" required />
    <datalist id="newCategoryList"></datalist>

    <select id="newStatus" required>
      <option value="Open">Open</option>
      <option value="Paid">Paid</option>
    </select>
 
<button id="entrySubmitBtn" class="add-entry-button" onclick="submitEntry()">Add Entry</button>
    <button id="cancelEditBtn" class="cancel-btn hidden" onclick="cancelEdit()">Cancel</button>
  <div class="form-actions">
    
  </div> </div>
</form>
   
       </div>



</form>
</div>


     </div>
  </div>


<h3 style="margin-left: 10px; margin-bottom: -10px; font-size: 0.9rem; color: #727272;">Bank Balances</h3>
<div class="filter-grid2">
  
    <!-- Original table rendering (can stay for fallback/testing) -->
<div id="bankBalanceTableContainer" ></div>
</div>
<!-- New card-based layout -->
<div id="bankBalanceCards" class="balance-card-grid"></div>




<div id="bankBalanceTotals"></div>


<script>
function renderBankBalanceCards() {
  const table = document.querySelector("#bankBalanceTableContainer table");
  if (!table) return;

  const headerCells = table.querySelectorAll("thead th");
  const changeCells = table.querySelectorAll("tbody tr:nth-child(2) td");

  const cardContainer = document.getElementById("bankBalanceCards");
  const totalsContainer = document.getElementById("bankBalanceTotals");
  if (!cardContainer || !totalsContainer) return;

  cardContainer.innerHTML = "";
  totalsContainer.innerHTML = "";

  let totalPlus = 0;
  let totalMinus = 0;

  for (let i = 1; i < headerCells.length; i++) {
    const bank = headerCells[i].textContent.trim();
    const delta = parseFloat(changeCells[i]?.textContent || "0") || 0;

    const card = document.createElement("div");
    card.className = "balance-card";
    card.innerHTML = `
      <small>${bank}</small>
      <div class="change-amount" style="color:${delta < 0 ? '#ff695d' : '#13a07f'}">${delta.toFixed(2)}</div>
    `;
    cardContainer.appendChild(card);

    // Totals
    if (delta > 0) totalPlus += delta;
    else totalMinus += delta;
  }

  // ‚úÖ Append totals inside card
 
if (!totalsContainer) return;

const summaryCard = document.createElement("div");
summaryCard.className = "balance-summary-card";
Differe = `
  <div class="label">Total Plus</div>
  <div class="value" id="v-totalPlus" style="color:#00bfff">+${totalPlus.toFixed(2)}</div>
  <div class="label">Total Minus</div>
  <div class="value" style="color:orangered">${totalMinus.toFixed(2)}</div>
  <div class="label">Difference</div>
  <div class="value" style="color:${(totalPlus + totalMinus) >= 0 ? '#13a07f' : '#ff695d'}">
    ${(totalPlus + totalMinus).toFixed(2)}
  </div>
`;

totalsContainer.appendChild(summaryCard);
}
</script>
<h3 style="margin-left: 10px; margin-top:-2px; margin-bottom: -5px; font-size: 0.9rem; color: #727272;">Kredit Limits</h3>
<div class="filter-grid">
<div class="credit-grid">
  <!-- Input Cards -->
  <div class="card">
    <div>UBS Master</div>
    <input type="number" id="creditLimit-ubs" value="3000" />
  </div>
  <div class="card">
    <div>Corner Master</div>
    <input type="number" id="creditLimit-corner" value="9900" />
  </div>
  <div class="card">
    <div>Post Master</div>
    <input type="number" id="creditLimit-pfm" value="1000" />
  </div>
  <div class="card">
    <div>Cembra</div>
    <input type="number" id="creditLimit-cembra" value="10000" />
  </div>

  <!-- Summary Cards -->
  <div class="card">
    <div>Total Limit</div>
    <strong id="v-totalLimit">0.00</strong>
  </div>
  <div class="card">
    <div>Used</div>
    <strong id="v-totalUsed">0.00</strong>
  </div>
  <div class="card">
    <div>Left</div>
    <strong id="v-diffUsed">0.00</strong>
  </div>
  <div class="card">
    <div>Total Plus</div>
    <strong id="v-limitPlusTotal">0.00</strong>
  </div>

  <!-- Button Card -->
  <div>
    <button id="unlockBtn">Unlock</button>
    <button id="lockBtn" style="display: none;">Lock & Save</button>
    <button id="saveLimitsBtn" style="display: none;">Save Limits</button>
  </div>
</div>
 
  </div>
<div class="filter-grid" >
<div class="summary-totals-card ">
  <div class="summary-card">
    <div class="label">Income</div>
    <a id="totalIncome" class="income-color">0.00</a>
  </div>
  <div class="summary-card">
    <div class="label">Expenses</div>
    <a id="totalExpense" class="expense-color">0.00</a>
  </div>
  <div class="summary-card">
    <div class="label">Balance</div>
    <a id="totalBalance" class="balance-color">0.00</a>
  </div>

 </div>
</div>
<div class="filter-grid" >
<div id="monthlyAverageCard"></div>
  </div>

 </div>

  <div class="tabs-wrapper">
 <div class="tabs">
      <div   id="personMultiSelect" onclick="togglePersonDropdown()">
       <button id="bt1"  id="selectedPersonsLabel">
  üë§&nbsp;&nbsp; person <span style="margin-left: 1px;">‚ñæ</span>
       </button>
        <div class="dropdown-options" id="personOptions" style="display: none;">
          <!-- Checkboxes inserted dynamically here -->
        </div>
 </div> 
       
 <div class="dropdown2">
  <button id="bt1"  class="dropdown-toggle" onclick="toggleDropdown('monthOptions')">üìÖ  &nbsp; month </button>
  <div class="dropdown-content2" id="monthOptions">
    <!-- Checkboxes will be inserted here dynamically -->
  </div>
</div>
     <div class="tooltip-wrapper">
  <button class="reset-btn" onclick="resetFilters()">
    <span class="reset-icon" style="color: black; font-size: 0.7rem;">clear all filters</span> 
  </button>
  <span class="tooltip-text">Reset all filters to default</span>
     
     
   
    </div> 
</div>

 </div>
</div>
 </div>

 </div>
</div>





  <div class="filter-grid">

<select id="categoryFilter">
  <option value="category">category</option>
</select>

       
          <select id="typeFilter">
            <option value="">type</option>
            <option>Income</option>
            <option>Expense</option>
            <option>Transfer</option>
          </select>
     
     
          <select id="currencyFilter">
            <option value="">currency</option>
            <option value="CHF">CHF</option>
            <option value="EUR">EUR</option>
            <option value="USD">USD</option>
          </select>
   
       
          <select id="bankFilter">
            <option value="">bank</option>
          </select>
     

     
<select id="statusFilter">
  <option value="All">status</option>
  <option value="Paid">Paid</option>
  <option value="Open">Open</option>
</select>


     
    
   </div>    
 

   
   
     
  
   </div>


 <div class="filter-grid">
  <div class="filter-field">
    <div class="input-wrapper">
      <input type="text" id="dateSearch" placeholder="date">
      <button class="clear-pill" onclick="clearField('dateSearch')">clear</button>
    </div>
  </div>

  <div class="filter-field">
    <div class="input-wrapper">
      <input type="text" id="amountSearch" placeholder="amount">
      <button class="clear-pill" onclick="clearField('amountSearch')">clear</button>
    </div>
  </div>

  <div class="filter-field">
    <div class="input-wrapper">
      <input type="text" id="categorySearch" placeholder="category">
      <button class="clear-pill" onclick="clearField('categorySearch')">clear</button>
    </div>
  </div>

  <div class="filter-field">
    <div class="input-wrapper">
      <input type="text" id="bankSearch" placeholder="bank">
      <button class="clear-pill" onclick="clearField('bankSearch')">clear</button>
    </div>
  </div>

  <div class="filter-field">
    <div class="input-wrapper">
      <input type="text" id="descSearch" placeholder="description">
      <button class="clear-pill" onclick="clearField('descSearch')">clear</button>
    </div>
  </div>
</div>


  

  <!-- Dashboard Tab -->
  <div id="dashboardTab" class="tab-content active">
   



  <script>

// Add entries
document.getElementById('entryForm').addEventListener('submit', async (e) => {
  e.preventDefault();
// Toggle visibility of person dropdown
document.querySelector('.dropdown-toggle').addEventListener('click', function () {
  const dropdown = document.getElementById('personDropdown');
  dropdown.classList.toggle('show');
});

  const inputDate = document.getElementById('newDate')._flatpickr?.selectedDates[0];
  function formatDateToLocalISO(date) {
    const offsetDate = new Date(date.getTime() - date.getTimezoneOffset() * 60000);
    return offsetDate.toISOString().split('T')[0];
  }
  const isoDate = inputDate ? formatDateToLocalISO(inputDate) : '';

  console.log('üì• Submitting entry...');
  const entry = {
    date: isoDate,
    description: document.getElementById('newDescription').value,
    category: document.getElementById('newCategory').value,
    amount: parseFloat(document.getElementById('newAmount').value),
    currency: document.getElementById('newCurrency').value,
    type: document.getElementById('newType').value,
    person: document.getElementById('newPerson').value,
    bank: document.getElementById('newBank').value,
    status: document.getElementById('newStatus')?.value || 'Paid' // ‚úÖ Add this line
  };
// ‚úÖ Log the entry before sending
console.log("üßæ Entry being submitted:", entry);
    try {
      const form = document.getElementById('entryForm');
      const editId = form.dataset.editId;

      const method = editId ? 'PUT' : 'POST';
      const url = editId
        ? `https://bookkeeping-i8e0.onrender.com/api/entries/${editId}`
        : 'https://bookkeeping-i8e0.onrender.com/api/entries';

 console.log('üßæ Entry being submitted:', entry);

      const res = await fetch(url, {
        method,
        headers: {
          Authorization: `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(entry)
      });

      if (!res.ok) {
        const err = await res.json();
        alert('‚ùå Error saving entry: ' + (err.message || res.statusText));
        return;
      }

      document.getElementById('entryForm').reset();
await fetchEntries();                    // reload data from server
if (editId) delete form.dataset.editId;

populateNewEntryDropdowns();            // refresh datalists
populateFilters();                      // refresh filters (e.g. categories)
renderEntries();                        // re-render entry table
renderBankBalanceForm();                // ‚úÖ re-render balance inputs


    } catch (error) {
      console.error('‚ùå Error saving entry:', error);
      alert('Failed to save entry.');
    }
  });
let monthlyChartInstance = null;
let personChartInstance = null;
let comparisonChartInstance = null;
let pieChartInstance = null;
let summaryChartInstance = null;
let averageChartInstance = null;

function drawCharts() {
  Chart.register(ChartDataLabels);

  const categoryFilter = document.getElementById('categoryFilter')?.value || 'All';
  const rawEntries = window.entries || [];
  window.entries = rawEntries.filter(e => typeof e === 'object');
  const entries = window.entries;

  const monthlyIncome = {}, monthlyExpense = {}, personIncome = {}, personExpense = {}, expenseByCategory = {};

  let selectedPersons = Array.from(document.querySelectorAll('.personChartFilter:checked')).map(cb => cb.value);
  if (!selectedPersons.length) {
    selectedPersons = [...new Set(entries.map(e => e.person))];
  }

  entries.forEach(e => {
    if (categoryFilter !== 'All' && (e.category || 'Uncategorized') !== categoryFilter) return;
    if (!selectedPersons.includes(e.person)) return;

    const month = e.date?.slice(0, 7);
    const person = e.person || 'Unknown';
    const value = parseFloat(e.amount) || 0;
    const key = e.category || 'Other';

    if (e.type === 'Income') {
      monthlyIncome[month] = (monthlyIncome[month] || 0) + value;
      personIncome[person] = (personIncome[person] || 0) + value;
    } else if (e.type === 'Expense') {
      monthlyExpense[month] = (monthlyExpense[month] || 0) + value;
      personExpense[person] = (personExpense[person] || 0) + value;
      expenseByCategory[key] = (expenseByCategory[key] || 0) + value;
    }
  });

  const incomeTotal = Object.values(monthlyIncome).reduce((a, b) => a + b, 0);
  const expenseTotal = Object.values(monthlyExpense).reduce((a, b) => a + b, 0);
  const difference = incomeTotal - expenseTotal;

  const months = [...new Set([...Object.keys(monthlyIncome), ...Object.keys(monthlyExpense)])].sort();
  const persons = [...new Set([...Object.keys(personIncome), ...Object.keys(personExpense)])];
  const categories = Object.keys(expenseByCategory);

  const incomeMonthVals = months.map(m => monthlyIncome[m] || 0);
  const expenseMonthVals = months.map(m => monthlyExpense[m] || 0);
  const incomePersonVals = persons.map(p => personIncome[p] || 0);
  const expensePersonVals = persons.map(p => personExpense[p] || 0);
  const pieValues = categories.map(k => expenseByCategory[k]);

  const type = document.getElementById('chartType').value;

  const ctx1 = document.getElementById('monthlyChart')?.getContext('2d');
  const ctx2 = document.getElementById('personChart')?.getContext('2d');
  const ctx3 = document.getElementById('comparisonChart')?.getContext('2d');
  const ctx4 = document.getElementById('pieChart')?.getContext('2d');
  const ctx5 = document.getElementById('summaryChart')?.getContext('2d');
  const avgCtx = document.getElementById('averageChart')?.getContext('2d');

  averageChartInstance?.destroy();
  monthlyChartInstance?.destroy();
  personChartInstance?.destroy();
  comparisonChartInstance?.destroy();
  pieChartInstance?.destroy();
  summaryChartInstance?.destroy();

  if (avgCtx) {
    const monthsCount = new Set(entries.map(e => e.date?.slice(0, 7))).size;
    const avgIncome = monthsCount ? incomeTotal / monthsCount : 0;
    const avgExpense = monthsCount ? expenseTotal / monthsCount : 0;
    const avgDiff = avgIncome - avgExpense;

    averageChartInstance = new Chart(avgCtx, {
      type: 'bar',
      data: {
        labels: ['Avg Income', 'Avg Expense', 'Avg Balance'],
        datasets: [{
          label: 'Average',
          data: [avgIncome, avgExpense, avgDiff],
          backgroundColor: ['#4caf50', '#f44336', '#2196f3']
        }]
      },
      plugins: [ChartDataLabels],
      options: {
        plugins: {
          datalabels: {
            anchor: 'end',
            align: 'top',
            font: { weight: 'bold' },
            formatter: v => v.toLocaleString('en-US', { minimumFractionDigits: 2 })
          }
        },
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  }

  if (ctx1) {
    monthlyChartInstance = new Chart(ctx1, {
      type,
      data: {
        labels: months,
        datasets: [
          { label: 'Income', data: incomeMonthVals, backgroundColor: '#4caf50', borderColor: '#2e7d32', borderWidth: 1 },
          { label: 'Expense', data: expenseMonthVals, backgroundColor: '#f44336', borderColor: '#c62828', borderWidth: 1 }
        ]
      },
      options: chartOptions(),
      plugins: [ChartDataLabels]
    });
  }

  if (ctx2) {
    personChartInstance = new Chart(ctx2, {
      type,
      data: {
        labels: persons,
        datasets: [
          { label: 'Income', data: incomePersonVals, backgroundColor: '#4caf50', borderColor: '#2e7d32', borderWidth: 1 },
          { label: 'Expense', data: expensePersonVals, backgroundColor: '#f44336', borderColor: '#c62828', borderWidth: 1 }
        ]
      },
      options: chartOptions(),
      plugins: [ChartDataLabels]
    });
  }

  if (ctx3) {
    comparisonChartInstance = new Chart(ctx3, {
      type,
      data: {
        labels: persons,
        datasets: [
          { label: 'Net Balance', data: persons.map(p => (personIncome[p] || 0) - (personExpense[p] || 0)), backgroundColor: '#2196f3', borderColor: '#1976d2', borderWidth: 1 }
        ]
      },
      options: chartOptions(),
      plugins: [ChartDataLabels]
    });
  }

  if (ctx5) {
    summaryChartInstance = new Chart(ctx5, {
      type: 'bar',
      data: {
        labels: ['Income', 'Expenses', 'Difference'],
        datasets: [{
          label: 'Summary',
          data: [incomeTotal, expenseTotal, difference],
          backgroundColor: ['#4caf50', '#f44336', '#2196f3']
        }]
      },
      options: {
        plugins: {
          datalabels: {
            anchor: 'end',
            align: 'top',
            font: { weight: 'bold' },
            formatter: value => value.toLocaleString('en-US', { minimumFractionDigits: 0 })
          }
        },
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  }

  if (ctx4) {
    pieChartInstance = new Chart(ctx4, {
      type: 'pie',
      data: {
        labels: categories,
        datasets: [{
          label: 'Spending Distribution',
          data: pieValues,
          backgroundColor: categories.map((_, i) => `hsl(${i * 35}, 70%, 60%)`)
        }]
      },
      options: {
        responsive: true,
        plugins: {
          tooltip: {
            callbacks: {
              label: context => `${context.label}: CHF ${context.raw.toFixed(2)}`
            }
          },
          legend: { position: 'bottom' }
        }
      }
    });
  }

  populatePersonFilter(persons);
} // ‚Üê‚úÖ THIS is the real end of drawCharts()


function populatePersonFilter(persons) {
  const container = document.getElementById('personDropdown');
  if (!container) return;

  container.innerHTML = `
    <label>
      <input type="checkbox" id="selectAllPersons" checked />
      <strong>Select All</strong>
    </label>
    <hr style="margin: 6px 0;">
    ${persons.map(p => `
      <label>
        <input type="checkbox" class="personChartFilter" value="${p}" checked />
        
        ${p}
      </label>
    `).join('')}
  `;

  // Prevent closing dropdown when clicking checkboxes
  container.addEventListener('click', (e) => {
    e.stopPropagation();
  });

  const selectAll = document.getElementById('selectAllPersons');
  const checkboxes = container.querySelectorAll('.personChartFilter');

  selectAll.addEventListener('change', () => {
    checkboxes.forEach(cb => cb.checked = selectAll.checked);
    drawCharts();
  });

  checkboxes.forEach(cb => {
    cb.addEventListener('change', () => {
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      selectAll.checked = allChecked;
      drawCharts();
    });
  });
}



    function populateCategoryFilter(entries) {
  const select = document.getElementById('categoryFilter');
  if (!select) return;
  const current = select.value;
  const categories = [...new Set(entries.map(e => e.category).filter(Boolean))].sort();
  select.innerHTML = '<option value="All">All</option>' + categories.map(c => `<option value="${c}">${c}</option>`).join('');
  select.value = current;
}

function chartOptions() {
  return {
    responsive: true,
    plugins: {
      tooltip: {
        callbacks: {
          label: context => `CHF ${context.raw.toFixed(2)}`
        }
      },
      legend: { display: true },
      datalabels: {
        color: '#000',
        anchor: 'end',
        align: 'top',
        font: {
          weight: 'bold'
        },
        formatter: value => value.toFixed(2)
      }
    },
    scales: {
      y: {
        beginAtZero: true
      }
    }
  };
}

    function downloadChart(id) {
      const canvas = document.getElementById(id);
      const link = document.createElement('a');
      link.download = id + '.png';
      link.href = canvas.toDataURL();
      link.click();
    }


    document.getElementById('chartType')?.addEventListener('change', drawCharts);
    document.getElementById('filterPerson')?.addEventListener('change', drawCharts);
document.getElementById('categoryFilter')?.addEventListener('change', drawCharts);
</script>

<script>
  function openTab(tabId, btn) {
    document.querySelectorAll('.tab-content').forEach(div => div.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));

    const targetTab = document.getElementById(tabId);
    if (targetTab) targetTab.classList.add('active');

    if (btn) btn.classList.add('active');

    if (tabId === 'chartsTab') {
      setTimeout(drawCharts, 50);
    }
  }
  document.querySelector('.dropdown-toggle')?.addEventListener('click', () => {
  const dropdown = document.getElementById('personDropdown');
  dropdown?.classList.toggle('show');
});
</script>
<div id="confirmModal" class="modal hidden">
  <div class="modal-content">
    <p>üóëÔ∏è Are you sure you want to delete this entry?</p>
    <div class="modal-actions">
      <button id="cancelDelete" class="btn cancel">Cancel</button>
      <button id="confirmDelete" class="btn confirm">Delete</button>
    </div>
  </div>
</div>
<div id="toast" style="display:none; position: fixed; bottom: 20px; right: 20px; background: #13a07f; color: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-size: 16px; z-index: 1000;"></div>



<!-- ‚úÖ Add these before your dashboard.js -->
 <div class="filter-grid"  >
<div id="entryTableBody" class="desktop-card-list"></div></div>


<div class="scroll-toggle-wrapper">
  <button class="scroll-toggle-btn" id="scrollUpBtn" title="Scroll to Top">‚¨Ü</button>
  <button class="scroll-toggle-btn" id="scrollDownBtn" title="Scroll to Bottom">‚¨á</button>
</div>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="dashboard.js"></script>

</body>
</html>


